<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SalaryHelper - åŠ³åŠ¨çº çº·æ™ºèƒ½åŠ©æ‰‹</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div class="app-header-content">
        <a href="index.html" class="app-logo">
          âš–ï¸ SalaryHelper
        </a>
        <div class="user-info">
          <span id="userName" class="text-secondary">åŠ è½½ä¸­...</span>
          <button id="logoutBtn" class="btn btn-sm btn-ghost">é€€å‡º</button>
        </div>
      </div>
    </header>

    <div class="main-content">
      <div class="container-wide">
        <div class="text-center mb-xl">
          <h1 class="mb-md">åŠ³åŠ¨çº çº·æ™ºèƒ½åŠ©æ‰‹</h1>
          <p class="text-secondary">ä¸€ç«™å¼åŠ³åŠ¨æ³•å’¨è¯¢ã€æ–‡ä¹¦ç”Ÿæˆå’Œæ¡ˆä»¶ç®¡ç†æœåŠ¡</p>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">æˆ‘çš„ä¼šè¯</div>
            <div class="stat-value" id="conversationCount">-</div>
            <div class="stat-change text-secondary">
              <span>ç‚¹å‡»ä¸‹æ–¹å¼€å§‹å’¨è¯¢</span>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-label">ç”Ÿæˆæ–‡ä¹¦</div>
            <div class="stat-value" id="documentCount">-</div>
            <div class="stat-change text-secondary">
              <span>å¿«é€Ÿç”Ÿæˆæ³•å¾‹æ–‡ä¹¦</span>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-label">æˆ‘çš„è®¢å•</div>
            <div class="stat-value" id="orderCount">-</div>
            <div class="stat-change text-secondary">
              <span>æŸ¥çœ‹æ¶ˆè´¹è®°å½•</span>
            </div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px;">
          <a href="conversations.html" class="card" style="text-decoration: none; color: inherit;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="font-size: 32px;">ğŸ’¬</div>
              <div style="flex: 1;">
                <h3 class="card-title">AI å¯¹è¯å’¨è¯¢</h3>
                <p class="text-secondary mb-0">ä¸æ™ºèƒ½åŠ©æ‰‹äº¤æµï¼Œè·å–ä¸“ä¸šçš„åŠ³åŠ¨æ³•å»ºè®®å’Œè§£å†³æ–¹æ¡ˆ</p>
              </div>
            </div>
          </a>

          <a href="docgen.html" class="card" style="text-decoration: none; color: inherit;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="font-size: 32px;">ğŸ“„</div>
              <div style="flex: 1;">
                <h3 class="card-title">æ–‡ä¹¦ç”Ÿæˆ</h3>
                <p class="text-secondary mb-0">åŸºäºæ¨¡æ¿å¿«é€Ÿç”ŸæˆåŠ³åŠ¨ä»²è£ã€ç”³è¯‰ç­‰å„ç±»æ³•å¾‹æ–‡ä¹¦</p>
              </div>
            </div>
          </a>

          <a href="evidence.html" class="card" style="text-decoration: none; color: inherit;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="font-size: 32px;">ğŸ“</div>
              <div style="flex: 1;">
                <h3 class="card-title">è¯æ®ç®¡ç†</h3>
                <p class="text-secondary mb-0">å®‰å…¨ä¸Šä¼ å’Œç®¡ç†æ‚¨çš„è¯æ®ææ–™ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼</p>
              </div>
            </div>
          </a>

          <a href="kb.html" class="card" style="text-decoration: none; color: inherit;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="font-size: 32px;">ğŸ“š</div>
              <div style="flex: 1;">
                <h3 class="card-title">çŸ¥è¯†åº“</h3>
                <p class="text-secondary mb-0">æµè§ˆåŠ³åŠ¨æ³•ç›¸å…³çŸ¥è¯†ã€æ¡ˆä¾‹åˆ†æå’Œå¸¸è§é—®é¢˜è§£ç­”</p>
              </div>
            </div>
          </a>

          <a href="payment.html" class="card" style="text-decoration: none; color: inherit;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="font-size: 32px;">ğŸ’³</div>
              <div style="flex: 1;">
                <h3 class="card-title">æ”¯ä»˜å……å€¼</h3>
                <p class="text-secondary mb-0">è´­ä¹°å’¨è¯¢æœåŠ¡ã€æ–‡ä¹¦ç”Ÿæˆå¥—é¤ç­‰å¢å€¼æœåŠ¡</p>
              </div>
            </div>
          </a>

          <a href="me.html" class="card" style="text-decoration: none; color: inherit;">
            <div style="display: flex; align-items: flex-start; gap: 16px;">
              <div style="font-size: 32px;">ğŸ‘¤</div>
              <div style="flex: 1;">
                <h3 class="card-title">ç”¨æˆ·ä¸­å¿ƒ</h3>
                <p class="text-secondary mb-0">ç®¡ç†ä¸ªäººä¿¡æ¯ã€æŸ¥çœ‹ä½¿ç”¨è®°å½•å’Œè´¦æˆ·è®¾ç½®</p>
              </div>
            </div>
          </a>
        </div>

        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
          <h3 style="color: white; margin-bottom: 8px;">ğŸ’¼ ç®¡ç†åå°</h3>
          <p style="margin-bottom: 16px; opacity: 0.9;">ç®¡ç†å‘˜å¯ä»¥è®¿é—®åå°æŸ¥çœ‹ç³»ç»Ÿæ•°æ®å’Œç®¡ç†ç”¨æˆ·</p>
          <a href="admin/index.html" class="btn btn-outline" style="background: white; color: #667eea; border-color: white;">
            è¿›å…¥ç®¡ç†åå° â†’
          </a>
        </div>

        <div class="alert alert-info mt-xl">
          <span>â„¹ï¸</span>
          <div>
            <strong>æ¼”ç¤ºè¯´æ˜ï¼š</strong>
            è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºç³»ç»Ÿï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯æ¨¡æ‹Ÿçš„ã€‚å®é™…ç”Ÿäº§ç¯å¢ƒéœ€è¦æ¥å…¥çœŸå®çš„AIæ¨¡å‹ã€æ•°æ®åº“å’Œæ”¯ä»˜ç³»ç»Ÿã€‚
          </div>
        </div>
      </div>
    </div>

    <div class="bottom-nav" style="display: none;" id="bottomNav">
      <div class="bottom-nav-content">
        <a href="index.html" class="bottom-nav-item active">
          <div class="bottom-nav-icon">ğŸ </div>
          <div class="bottom-nav-label">é¦–é¡µ</div>
        </a>
        <a href="conversations.html" class="bottom-nav-item">
          <div class="bottom-nav-icon">ğŸ’¬</div>
          <div class="bottom-nav-label">å¯¹è¯</div>
        </a>
        <a href="docgen.html" class="bottom-nav-item">
          <div class="bottom-nav-icon">ğŸ“„</div>
          <div class="bottom-nav-label">æ–‡ä¹¦</div>
        </a>
        <a href="me.html" class="bottom-nav-item">
          <div class="bottom-nav-icon">ğŸ‘¤</div>
          <div class="bottom-nav-label">æˆ‘çš„</div>
        </a>
      </div>
    </div>
  </div>
  
  <script src="api-client-real.js"></script>
  <script>
    const userName = document.getElementById('userName');
    const logoutBtn = document.getElementById('logoutBtn');
    const conversationCount = document.getElementById('conversationCount');
    const documentCount = document.getElementById('documentCount');
    const orderCount = document.getElementById('orderCount');
    const bottomNav = document.getElementById('bottomNav');
    
    async function updateUserInfo() {
      if (!ApiClient.isLoggedIn()) {
        userName.innerHTML = '<a href="login.html" style="color: var(--primary-color);">è¯·ç™»å½•</a>';
        return;
      }
      
      try {
        const user = ApiClient.getCurrentUserSync();
        if (user) {
          userName.textContent = user.name || user.phone;
        } else {
          try {
            const freshUser = await ApiClient.getCurrentUser();
            userName.textContent = freshUser.name || freshUser.phone;
          } catch (error) {
            console.error('Failed to get current user:', error);
            userName.innerHTML = '<a href="login.html" style="color: var(--primary-color);">è¯·ç™»å½•</a>';
          }
        }
      } catch (error) {
        console.error('Error updating user info:', error);
        userName.innerHTML = '<a href="login.html" style="color: var(--primary-color);">è¯·ç™»å½•</a>';
      }
    }
    
    async function loadStats() {
      if (!ApiClient.isLoggedIn()) {
        conversationCount.textContent = '0';
        documentCount.textContent = '0';
        orderCount.textContent = '0';
        return;
      }
      
      try {
        const [conversations, documents, orders] = await Promise.all([
          ApiClient.listConversations().catch(() => []),
          ApiClient.listDocuments().catch(() => []),
          ApiClient.listOrders().catch(() => [])
        ]);
        
        conversationCount.textContent = conversations.length;
        documentCount.textContent = documents.length;
        orderCount.textContent = orders.length;
      } catch (error) {
        console.error('Failed to load stats:', error);
        conversationCount.textContent = '0';
        documentCount.textContent = '0';
        orderCount.textContent = '0';
      }
    }
    
    logoutBtn.addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        ApiClient.logout();
        window.location.href = '/static/login.html';
      }
    });
    
    if (window.innerWidth <= 768) {
      bottomNav.style.display = 'block';
      document.querySelector('.main-content').style.paddingBottom = '80px';
    }
    
    window.addEventListener('resize', () => {
      if (window.innerWidth <= 768) {
        bottomNav.style.display = 'block';
        document.querySelector('.main-content').style.paddingBottom = '80px';
      } else {
        bottomNav.style.display = 'none';
        document.querySelector('.main-content').style.paddingBottom = '24px';
      }
    });
    
    updateUserInfo();
    loadStats();
  </script>
</body>
</html>
