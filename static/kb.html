<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>çŸ¥è¯†åº“ - SalaryHelper</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div class="app-header-content">
        <a href="index.html" class="app-logo">
          âš–ï¸ SalaryHelper
        </a>
        <div class="user-info">
          <span id="userName" class="text-secondary">åŠ è½½ä¸­...</span>
          <button id="logoutBtn" class="btn btn-sm btn-ghost">é€€å‡º</button>
        </div>
      </div>
    </header>

    <div class="main-content">
      <div class="container-wide">
        <div class="flex justify-between items-center mb-lg">
          <div>
            <h2 class="mb-0">åŠ³åŠ¨æ³•çŸ¥è¯†åº“</h2>
            <p class="text-secondary mt-sm">æµè§ˆåŠ³åŠ¨æ³•ç›¸å…³çŸ¥è¯†ã€æ¡ˆä¾‹åˆ†æå’Œå¸¸è§é—®é¢˜</p>
          </div>
          <a href="index.html" class="btn btn-ghost">
            â† è¿”å›é¦–é¡µ
          </a>
        </div>

        <div class="card mb-lg">
          <div class="form-group mb-0">
            <div class="flex gap-sm">
              <input 
                type="search" 
                id="searchInput" 
                class="form-control" 
                placeholder="æœç´¢åŠ³åŠ¨æ³•ç›¸å…³é—®é¢˜..."
                style="flex: 1;"
              />
              <button id="searchBtn" class="btn btn-primary">
                ğŸ” æœç´¢
              </button>
            </div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 240px 1fr; gap: 24px;" class="kb-container">
          <div>
            <div class="card">
              <h3 class="card-title">åˆ†ç±»</h3>
              <div id="categories" class="flex flex-col gap-sm"></div>
            </div>
          </div>

          <div>
            <div id="articlesList"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="articleModal" class="modal-overlay hidden">
      <div class="modal" style="max-width: 800px;">
        <div class="modal-header">
          <h3 class="modal-title" id="articleTitle">æ–‡ç« æ ‡é¢˜</h3>
          <button class="modal-close" onclick="document.getElementById('articleModal').classList.add('hidden')">&times;</button>
        </div>
        <div class="modal-body">
          <div id="articleContent" style="line-height: 1.8;"></div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="api-client-real.js"></script>
  <script>
    const userName = document.getElementById('userName');
    const logoutBtn = document.getElementById('logoutBtn');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const categories = document.getElementById('categories');
    const articlesList = document.getElementById('articlesList');
    const articleModal = document.getElementById('articleModal');
    const articleTitle = document.getElementById('articleTitle');
    const articleContent = document.getElementById('articleContent');
    
    let selectedCategory = 'å…¨éƒ¨';
    
    const mockCategories = ['å…¨éƒ¨', 'å·¥èµ„çº çº·', 'åŠ³åŠ¨åˆåŒ', 'ç¤¾ä¿ç¦åˆ©', 'å·¥ä¼¤èµ”å¿', 'åŠ ç­åŠ ç‚¹', 'ç¦»èŒè¾é€€', 'å¸¸è§é—®é¢˜'];
    
    const mockArticles = [
      {
        id: 1,
        category: 'å·¥èµ„çº çº·',
        title: 'ç”¨äººå•ä½æ‹–æ¬ å·¥èµ„æ€ä¹ˆåŠï¼Ÿ',
        summary: 'é‡åˆ°æ‹–æ¬ å·¥èµ„çš„æƒ…å†µï¼ŒåŠ³åŠ¨è€…å¯ä»¥é€šè¿‡åå•†ã€æŠ•è¯‰æˆ–åŠ³åŠ¨ä»²è£ç­‰æ–¹å¼ç»´æƒ...',
        content: 'ç”¨äººå•ä½æ‹–æ¬ å·¥èµ„æ˜¯åŠ³åŠ¨çº çº·ä¸­æœ€å¸¸è§çš„é—®é¢˜ä¹‹ä¸€ã€‚æ ¹æ®ã€ŠåŠ³åŠ¨æ³•ã€‹ç¬¬50æ¡è§„å®šï¼Œå·¥èµ„åº”å½“ä»¥è´§å¸å½¢å¼æŒ‰æœˆæ”¯ä»˜ç»™åŠ³åŠ¨è€…æœ¬äººã€‚\n\nè§£å†³æ–¹æ¡ˆï¼š\n1. å…ˆä¸ç”¨äººå•ä½åå•†è§£å†³\n2. å‘åŠ³åŠ¨ç›‘å¯Ÿéƒ¨é—¨æŠ•è¯‰\n3. ç”³è¯·åŠ³åŠ¨ä»²è£\n4. å‘äººæ°‘æ³•é™¢èµ·è¯‰\n\næ³¨æ„äº‹é¡¹ï¼š\nâ€¢ ä¿ç•™å·¥èµ„æ¡ã€æ‰“å¡è®°å½•ç­‰è¯æ®\nâ€¢ æ³¨æ„æ—¶æ•ˆæœŸé™ï¼ˆ1å¹´ï¼‰\nâ€¢ å¯ä»¥è¦æ±‚ç»æµè¡¥å¿'
      },
      {
        id: 2,
        category: 'åŠ³åŠ¨åˆåŒ',
        title: 'ä¸ç­¾åŠ³åŠ¨åˆåŒæœ‰ä»€ä¹ˆåæœï¼Ÿ',
        summary: 'ç”¨äººå•ä½åº”å½“è‡ªç”¨å·¥ä¹‹æ—¥èµ·ä¸€ä¸ªæœˆå†…è®¢ç«‹ä¹¦é¢åŠ³åŠ¨åˆåŒï¼Œå¦åˆ™éœ€æ‰¿æ‹…æ³•å¾‹è´£ä»»...',
        content: 'æ ¹æ®ã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç¬¬10æ¡è§„å®šï¼Œå»ºç«‹åŠ³åŠ¨å…³ç³»ï¼Œåº”å½“è®¢ç«‹ä¹¦é¢åŠ³åŠ¨åˆåŒã€‚\n\nå•ä½ä¸ç­¾åˆåŒçš„åæœï¼š\n1. éœ€æ”¯ä»˜åŒå€å·¥èµ„ï¼ˆæœ€å¤š11ä¸ªæœˆï¼‰\n2. è§†ä¸ºæ— å›ºå®šæœŸé™åŠ³åŠ¨åˆåŒ\n3. åŠ³åŠ¨è€…å¯éšæ—¶è§£é™¤åŠ³åŠ¨å…³ç³»\n\nåŠ³åŠ¨è€…æƒç›Šï¼š\nâ€¢ å¯ä»¥è¦æ±‚ç­¾è®¢åŠ³åŠ¨åˆåŒ\nâ€¢ å¯ä»¥è¦æ±‚æ”¯ä»˜åŒå€å·¥èµ„\nâ€¢ å¯ä»¥ä¸»å¼ å„é¡¹ç¤¾ä¼šä¿é™©'
      },
      {
        id: 3,
        category: 'ç¤¾ä¿ç¦åˆ©',
        title: 'å…¬å¸ä¸ç¼´çº³ç¤¾ä¿æ€ä¹ˆåŠï¼Ÿ',
        summary: 'ç”¨äººå•ä½å’ŒåŠ³åŠ¨è€…å¿…é¡»ä¾æ³•å‚åŠ ç¤¾ä¼šä¿é™©ï¼Œç¼´çº³ç¤¾ä¼šä¿é™©è´¹...',
        content: 'æ ¹æ®ã€Šç¤¾ä¼šä¿é™©æ³•ã€‹è§„å®šï¼Œç”¨äººå•ä½åº”å½“è‡ªç”¨å·¥ä¹‹æ—¥èµ·30æ—¥å†…ä¸ºå…¶èŒå·¥å‘ç¤¾ä¼šä¿é™©ç»åŠæœºæ„ç”³è¯·åŠç†ç¤¾ä¼šä¿é™©ç™»è®°ã€‚\n\nç»´æƒé€”å¾„ï¼š\n1. å‘ç¤¾ä¿éƒ¨é—¨æŠ•è¯‰ä¸¾æŠ¥\n2. ç”³è¯·åŠ³åŠ¨ä»²è£\n3. è¦æ±‚è¡¥ç¼´ç¤¾ä¿\n\næ³¨æ„äº‹é¡¹ï¼š\nâ€¢ ç¤¾ä¿æ˜¯å¼ºåˆ¶æ€§çš„\nâ€¢ å•ä½æ‰¿æ‹…å¤§éƒ¨åˆ†è´¹ç”¨\nâ€¢ åŒ…æ‹¬å…»è€ã€åŒ»ç–—ã€å¤±ä¸šã€å·¥ä¼¤ã€ç”Ÿè‚²ä¿é™©'
      },
      {
        id: 4,
        category: 'å·¥ä¼¤èµ”å¿',
        title: 'å‘ç”Ÿå·¥ä¼¤å¦‚ä½•ç”³è¯·èµ”å¿ï¼Ÿ',
        summary: 'å·¥ä¼¤è®¤å®šæ˜¯è·å¾—å·¥ä¼¤èµ”å¿çš„å‰æï¼Œåº”åŠæ—¶å‘äººåŠ›èµ„æºç¤¾ä¼šä¿éšœéƒ¨é—¨ç”³è¯·...',
        content: 'å·¥ä¼¤èµ”å¿æµç¨‹ï¼š\n\n1. å·¥ä¼¤è®¤å®šï¼ˆ30å¤©å†…ï¼‰\n2. åŠ³åŠ¨èƒ½åŠ›é‰´å®š\n3. å·¥ä¼¤å¾…é‡ç”³é¢†\n\nèµ”å¿é¡¹ç›®ï¼š\nâ€¢ åŒ»ç–—è´¹\nâ€¢ ä½é™¢ä¼™é£Ÿè¡¥åŠ©è´¹\nâ€¢ æŠ¤ç†è´¹\nâ€¢ åœå·¥ç•™è–ªæœŸå·¥èµ„\nâ€¢ ä¸€æ¬¡æ€§ä¼¤æ®‹è¡¥åŠ©é‡‘\nâ€¢ ä¸€æ¬¡æ€§å·¥ä¼¤åŒ»ç–—è¡¥åŠ©é‡‘\nâ€¢ ä¸€æ¬¡æ€§ä¼¤æ®‹å°±ä¸šè¡¥åŠ©é‡‘\n\næ³¨æ„äº‹é¡¹ï¼š\nâ€¢ åŠæ—¶å°±åŒ»å¹¶ä¿ç•™ç—…å†\nâ€¢ 30å¤©å†…ç”³è¯·å·¥ä¼¤è®¤å®š\nâ€¢ å•ä½æ‹’ç»å¯è‡ªè¡Œç”³è¯·'
      },
      {
        id: 5,
        category: 'åŠ ç­åŠ ç‚¹',
        title: 'åŠ ç­è´¹å¦‚ä½•è®¡ç®—ï¼Ÿ',
        summary: 'ç”¨äººå•ä½å®‰æ’åŠ ç­çš„ï¼Œåº”å½“æŒ‰ç…§æ³•å®šæ ‡å‡†æ”¯ä»˜åŠ ç­è´¹...',
        content: 'åŠ ç­è´¹è®¡ç®—æ ‡å‡†ï¼š\n\n1. å·¥ä½œæ—¥åŠ ç­ï¼šå·¥èµ„çš„150%\n2. ä¼‘æ¯æ—¥åŠ ç­ï¼šå·¥èµ„çš„200%ï¼ˆä¸èƒ½è°ƒä¼‘çš„æƒ…å†µï¼‰\n3. æ³•å®šèŠ‚å‡æ—¥åŠ ç­ï¼šå·¥èµ„çš„300%\n\nè®¡ç®—å…¬å¼ï¼š\nåŠ ç­è´¹ = æœˆå·¥èµ„ Ã· 21.75å¤© Ã· 8å°æ—¶ Ã— åŠ ç­å°æ—¶æ•° Ã— å€æ•°\n\næ³¨æ„äº‹é¡¹ï¼š\nâ€¢ ä¿ç•™åŠ ç­è¯æ®ï¼ˆæ‰“å¡è®°å½•ç­‰ï¼‰\nâ€¢ æ³•å®šèŠ‚å‡æ—¥åŠ ç­å¿…é¡»æ”¯ä»˜åŠ ç­è´¹\nâ€¢ åŠ ç­è´¹ä¸èƒ½ç”¨è°ƒä¼‘ä»£æ›¿'
      },
      {
        id: 6,
        category: 'ç¦»èŒè¾é€€',
        title: 'å…¬å¸è¿æ³•è¾é€€æ€ä¹ˆåŠï¼Ÿ',
        summary: 'ç”¨äººå•ä½è¿æ³•è§£é™¤åŠ³åŠ¨åˆåŒçš„ï¼Œåº”å½“æ”¯ä»˜èµ”å¿é‡‘...',
        content: 'è¿æ³•è¾é€€çš„æƒ…å½¢ï¼š\n\n1. æ— æ­£å½“ç†ç”±è¾é€€\n2. æœªæå‰é€šçŸ¥è¾é€€\n3. å­•æœŸã€äº§æœŸã€å“ºä¹³æœŸè¾é€€\n4. å·¥ä¼¤æœŸé—´è¾é€€\n\nèµ”å¿æ ‡å‡†ï¼š\nâ€¢ ç»æµèµ”å¿é‡‘ = 2 Ã— ç»æµè¡¥å¿é‡‘\nâ€¢ ç»æµè¡¥å¿é‡‘ = å·¥ä½œå¹´é™ Ã— æœˆå·¥èµ„\n\nç»´æƒæ–¹å¼ï¼š\n1. è¦æ±‚ç»§ç»­å±¥è¡ŒåˆåŒ\n2. è¦æ±‚æ”¯ä»˜èµ”å¿é‡‘\n3. ç”³è¯·åŠ³åŠ¨ä»²è£\n\næ³¨æ„äº‹é¡¹ï¼š\nâ€¢ åŠæ—¶å›ºå®šè¯æ®\nâ€¢ æ³¨æ„ä»²è£æ—¶æ•ˆ\nâ€¢ å¯ä»¥è¦æ±‚å‡ºå…·ç¦»èŒè¯æ˜'
      }
    ];
    
    function checkLoginStatus() {
      if (!ApiClient.isLoggedIn()) {
        window.location.href = '/static/login.html';
        return false;
      }
      return true;
    }
    
    async function updateUserInfo() {
      if (!checkLoginStatus()) return;
      
      try {
        const user = ApiClient.getCurrentUserSync();
        if (user) {
          userName.textContent = user.name || user.phone;
        }
      } catch (error) {
        console.error('Error updating user info:', error);
      }
    }
    
    function renderCategories() {
      categories.innerHTML = mockCategories.map(cat => `
        <button 
          class="btn ${selectedCategory === cat ? 'btn-primary' : 'btn-ghost'} btn-block text-left"
          onclick="selectCategory('${cat}')"
          style="justify-content: flex-start;"
        >
          ${cat}
        </button>
      `).join('');
    }
    
    function selectCategory(category) {
      selectedCategory = category;
      renderCategories();
      renderArticles();
    }
    
    function renderArticles(searchQuery = '') {
      let filtered = mockArticles;
      
      if (selectedCategory !== 'å…¨éƒ¨') {
        filtered = filtered.filter(a => a.category === selectedCategory);
      }
      
      if (searchQuery) {
        filtered = filtered.filter(a => 
          a.title.includes(searchQuery) || 
          a.summary.includes(searchQuery) ||
          a.content.includes(searchQuery)
        );
      }
      
      if (filtered.length === 0) {
        articlesList.innerHTML = `
          <div class="card">
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“š</div>
              <div class="empty-state-title">æš‚æ— ç›¸å…³å†…å®¹</div>
              <div class="empty-state-text">è¯•è¯•å…¶ä»–å…³é”®è¯æˆ–åˆ†ç±»</div>
            </div>
          </div>
        `;
        return;
      }
      
      articlesList.innerHTML = filtered.map(article => `
        <div class="card mb-lg" style="cursor: pointer;" onclick="openArticle(${article.id})">
          <div class="card-header">
            <h3 class="card-title">${article.title}</h3>
            <div class="badge badge-primary">${article.category}</div>
          </div>
          <div class="card-body">
            <p class="text-secondary mb-0">${article.summary}</p>
          </div>
          <div class="card-footer">
            <span class="text-secondary" style="font-size: 13px;">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</span>
            <span>â†’</span>
          </div>
        </div>
      `).join('');
    }
    
    function openArticle(id) {
      const article = mockArticles.find(a => a.id === id);
      if (!article) return;
      
      articleTitle.textContent = article.title;
      articleContent.innerHTML = `
        <div class="mb-lg">
          <span class="badge badge-primary">${article.category}</span>
        </div>
        <div style="white-space: pre-wrap; line-height: 2;">${article.content}</div>
        <div class="mt-xl p-lg" style="background: var(--bg-secondary); border-radius: 8px;">
          <div class="text-secondary mb-sm">ç›¸å…³æœåŠ¡</div>
          <div class="btn-group">
            <a href="conversations.html" class="btn btn-outline btn-sm">ğŸ’¬ å’¨è¯¢AIåŠ©æ‰‹</a>
            <a href="docgen.html" class="btn btn-outline btn-sm">ğŸ“„ ç”Ÿæˆæ–‡ä¹¦</a>
          </div>
        </div>
      `;
      
      articleModal.classList.remove('hidden');
    }
    
    window.selectCategory = selectCategory;
    window.openArticle = openArticle;
    
    searchBtn.addEventListener('click', () => {
      const query = searchInput.value.trim();
      renderArticles(query);
    });
    
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchBtn.click();
      }
    });
    
    logoutBtn.addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        ApiClient.logout();
        window.location.href = '/static/login.html';
      }
    });
    
    if (checkLoginStatus()) {
      updateUserInfo();
      renderCategories();
      renderArticles();
    }
    
    if (window.innerWidth <= 768) {
      document.querySelector('.kb-container').style.gridTemplateColumns = '1fr';
    }
  </script>
</body>
</html>
